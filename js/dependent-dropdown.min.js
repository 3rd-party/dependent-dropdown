/*!
 * @copyright &copy; Kartik Visweswaran, Krajee.com, 2014
 * @version 1.0.0
 *
 * A multi level dependent dropdown JQuery plugin. The plugin
 * allows nested and combined dependencies.
 * 
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */(function(e){var t=function(t,n){return typeof t==="undefined"||t===null||t===undefined||t==[]||t===""||n&&e.trim(t)===""};var n=function(t,n,r,i){var s=n==i&&i!==null?{value:n,text:r,selected:"selected"}:{value:n,text:r};e("<option/>",s).appendTo(t)};var r=function(r,i,s){var o=e("<select>");if(!t(i)){n(o,"",i,s)}e.each(r,function(t,r){if(r.id){n(o,r.id,r.name,s)}else{var i=e("<optgroup>",{label:t});e.each(r,function(e,t){n(i,t.id,t.name,s)});i.appendTo(o)}});return o.html()};var i=function(t,n){this.$element=e(t);this.url=n.url;this.depends=n.depends;this.emptyMsg=n.emptyMsg;this.loading=n.loading;this.placeholder=n.placeholder;this.init()};i.prototype={constructor:i,init:function(){var t=this,n=t.depends,r,i={},s=n.length;t.$element.attr("disabled","disabled");if(t.placeholder!=""){t.$element.find('option[value=""]').remove();t.$element.prepend('<option value="">'+t.placeholder+"</option>")}for(var o=0;o<s;o++){r=e("#"+n[o]);r.on("change",function(){for(var o=0;o<s;o++){r=e("#"+n[o]);i[o]=r.val()}e.ajax(t.getSettings(i))})}},getSettings:function(e){var i=this;var s={url:i.url,type:"post",data:{id:e},dataType:"json",success:function(e){var s=t(e.selected)?null:e.selected;if(e.length===0){n(i.$element,"",i.emptyMsg,"")}else{i.$element.html(r(e.output,i.placeholder,s));if(i.$element.find("optgroup").length>0){i.$element.find('option[value=""]').attr("disabled","disabled")}i.$element.val(s);if(e.output.length!==0){i.$element.removeAttr("disabled")}}var o=i.$element.find("option").length;if(i.$element.find('option[value=""]').length>0){o--}i.$element.trigger("depdrop.change",[i.$element.val(),o])}};s["beforeSend"]=function(){i.$element.trigger("depdrop.beforeChange",[i.$element.val()]);i.$element.attr("disabled","disabled");i.$element.html("");if(i.loading){i.$element.addClass("kv-loading")}};s["error"]=function(){i.$element.trigger("depdrop.error",[i.$element.val()])};s["complete"]=function(){i.$element.trigger("depdrop.afterChange",[i.$element.val()]);if(i.loading){i.$element.removeClass("kv-loading")}};return s}};e.fn.depdrop=function(t){var n=Array.apply(null,arguments);n.shift();return this.each(function(){var r=e(this),s=r.data("depdrop"),o=typeof t==="object"&&t;if(!s){r.data("depdrop",s=new i(this,e.extend({},e.fn.depdrop.defaults,o,e(this).data())))}if(typeof t==="string"){s[t].apply(s,n)}})};e.fn.depdrop.defaults={url:"",emptyMsg:"No data found",loading:true,placeholder:""}})(jQuery)