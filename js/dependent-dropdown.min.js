/*!
 * @copyright &copy; Kartik Visweswaran, Krajee.com, 2014
 * @version 1.0.0
 *
 * A multi level dependent dropdown JQuery plugin. The plugin
 * allows nested and combined dependencies.
 * 
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */(function(e){var t=function(t,n){return typeof t==="undefined"||t===null||t===undefined||t==[]||t===""||n&&e.trim(t)===""};var n=function(t,n,r,i){var s=n==i&&i!==null?{value:n,text:r,selected:"selected"}:{value:n,text:r};e("<option/>",s).appendTo(t)};var r=function(t,r,i){var s=e("<select>");if(r!==false){n(s,"",r,i)}e.each(t,function(t,r){if(r.id){n(s,r.id,r.name,i)}else{var o=e("<optgroup>",{label:t});e.each(r,function(e,t){n(o,t.id,t.name,i)});o.appendTo(s)}});return s.html()};var i=function(i,s,o,u,a,f,l,c,h){var p=i,d=s,v=o,m=u,g=a,y=0,b=h;var w={url:d,type:"post",data:{depdrop_parents:m},dataType:"json",success:function(i){var s=t(i.selected)?null:i.selected;if(i==null||i.length===0){n(p,"",b,"")}else{p.html(r(i.output,g,s));if(p.find("optgroup").length>0){p.find('option[value=""]').attr("disabled","disabled")}if(i.output.length!==0){p.val(s);p.removeAttr("disabled")}}y=p.find("option").length;if(p.find('option[value=""]').length>0){y--}p.trigger("depdrop.change",[v,e("#"+v).val(),y])}};w["beforeSend"]=function(){p.trigger("depdrop.beforeChange",[v,e("#"+v).val()]);p.attr("disabled","disabled");p.html("");if(f){p.addClass(l);p.html('<option id="">'+c+"</option>")}};w["error"]=function(){p.trigger("depdrop.error",[v,e("#"+v).val()])};w["complete"]=function(){p.trigger("depdrop.afterChange",[v,e("#"+v).val()]);if(f){p.removeClass(l)}};return w};var s=function(t,n){this.$element=e(t);this.url=n.url;this.depends=n.depends;this.loading=n.loading;this.loadingClass=n.loadingClass;this.loadingText=n.loadingText;this.placeholder=n.placeholder;this.emptyMsg=n.emptyMsg;this.init()};s.prototype={constructor:s,init:function(){var t=this,n=t.depends,r,i=n.length;t.$element.attr("disabled","disabled");if(t.placeholder!==false){t.$element.find('option[value=""]').remove();t.$element.prepend('<option value="">'+t.placeholder+"</option>")}for(var s=0;s<i;s++){r=e("#"+n[s]);r.on("change",function(){t.setDependency(r,n,i)});e(document).ready(function(){t.setDependency(r,n,i)})}t.$element.trigger("depdrop.init")},setDependency:function(t,n,r){var s=this,o={};for(var u=0;u<r;u++){var a=e("#"+n[u]);o[u]=a.val()}e.ajax(i(s.$element,s.url,t.attr("id"),o,s.placeholder,s.loading,s.loadingClass,s.loadingText,s.emptyMsg))}};e.fn.depdrop=function(t){var n=Array.apply(null,arguments);n.shift();return this.each(function(){var r=e(this),i=r.data("depdrop"),o=typeof t==="object"&&t;if(!i){r.data("depdrop",i=new s(this,e.extend({},e.fn.depdrop.defaults,o,e(this).data())))}if(typeof t==="string"){i[t].apply(i,n)}})};e.fn.depdrop.defaults={url:"",loading:true,loadingClass:"kv-loading",loadingText:"Loading ...",placeholder:"Select ...",emptyMsg:"No data found"};e(function(){e("select.depdrop").depdrop()})})(jQuery)